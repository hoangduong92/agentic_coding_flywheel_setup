# WezTerm Automata (wa): Terminal Hypervisor for AI Agents

**Goal:** Use wa to coordinate multiple AI coding agents running in WezTerm.

---

## What is wa?

WezTerm Automata is a terminal hypervisor that captures pane output in real-time, detects agent state transitions through pattern matching, and enables event-driven automation across multiple AI coding agents.

**Key Capabilities:**
- Real-time terminal output observation (sub-50ms latency)
- Pattern detection for rate limits, errors, completions
- Robot Mode API for machine-to-machine communication
- Full-text search across all captured sessions
- Safety policy engine with audit trails

---

## Essential Commands

### Daemon Management

```bash
# Start the observation daemon
wa daemon start

# Check daemon status
wa daemon status

# Stop the daemon
wa daemon stop
```

### Robot Mode (for Agent Integration)

```bash
# View all panes as structured JSON
wa robot state

# Get text from a specific pane
wa robot get-text <pane_id>

# Send input to a pane (with safety checks)
wa robot send <pane_id> "your command here"

# Wait for a pattern to appear
wa robot wait-for <pane_id> "pattern"
```

---

## Searching Captured Output

wa includes FTS5-powered full-text search across all terminal sessions:

```bash
# Search for content across all sessions
wa search "error message"

# Search with context
wa search "rate limit" --context 5
```

---

## Pattern Detection

wa detects state transitions for common AI agents:

| Agent | Detected States |
|-------|-----------------|
| Claude Code | Rate limits, approval prompts, completions |
| Codex CLI | Task completion, errors, waiting states |
| Gemini CLI | Response completion, quota warnings |

When a pattern is detected, wa can trigger automated workflows.

---

## Integration with Other Tools

- **NTM**: wa observes agents spawned by NTM
- **Agent Mail**: State changes can trigger mail notifications
- **Beads**: Task completions can update bead status

---

## Quick Reference

| Command | What it does |
|---------|--------------|
| `wa daemon start` | Start observation daemon |
| `wa daemon status` | Check daemon status |
| `wa robot state` | View all panes as JSON |
| `wa robot get-text <id>` | Get pane output |
| `wa robot send <id> "..."` | Send input to pane |
| `wa robot wait-for <id> <pat>` | Wait for pattern |
| `wa search "..."` | Search captured output |

---

## Safety Features

wa includes a safety policy engine:
- Capability gates restrict what commands can be sent
- Rate limiting prevents runaway automation
- Audit trails log all actions for review

---

## Troubleshooting

```bash
# Run diagnostics
wa doctor

# Check if daemon is running
wa daemon status

# View logs
wa logs --tail 50
```

---

*Run `wa daemon start` to begin observing your terminal sessions!*
